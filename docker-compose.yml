services:
  go-docker-proxy:
    build: .
    ports:
      - "8080:8080"
    environment:
      # 基础配置
      - PORT=8080
      - CUSTOM_DOMAIN=example.com
      
      # 缓存配置
      - CACHE_DIR=/cache
      - CACHE_ENABLED=true  # true=启用缓存, false=禁用缓存
      
      # 黑名单配置 (访问受限的域名，逗号分隔)
      # 示例: BLOCKED_HOSTS=example.com,another.com
      - BLOCKED_HOSTS=
      
      # 调试和开发
      - DEBUG=true
      - TARGET_UPSTREAM=https://registry-1.docker.io
    volumes:
      - cache_data:/cache
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "/go-docker-proxy", "-health-check"]
      interval: 30s
      timeout: 3s
      start_period: 5s
      retries: 3

volumes:
  cache_data:
    driver: local
    driver_opts:
      type: none
      o: bind
      device: "./cache"
